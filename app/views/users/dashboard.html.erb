<div class="container">
  <h2>Hi <%= @user.first_name %>, this is your dashboard</h2>

  <h3>Your bookings as a desperate</h3>
  <% if @user.bookings.empty? %>
    <p>You don't have any bookings... check out <%= link_to "all our personalities", personalities_path %> to find your next date. ğŸ˜</p>
  <% else %>
        <div class="booking-card-container">
      <% @user.bookings.sort_by(&:date).each do |booking| %>
        <div class="booking-card">
          <img src="<%= booking.personality.picture %>" alt="" class="big-avatar">
          <div class="booking-card-details">
            <p><strong>When?</strong> <%= booking.date %></p>
            <p><strong>With who?</strong> <%= link_to booking.personality.first_name + " " + booking.personality.last_name, personality_path(booking.personality) %></p>
          </div>
          <div>
            <p>
              <%= link_to "Delete booking", booking_path(booking), method: :delete, data: { confirm: "Are you sure you want to delete this booking?" }, class: "text-danger" %>
            </p>
            <p>
              <% if booking.review.nil? || booking.review.personality_rating.nil? %>
                <%= link_to "Add a review", new_review_path(booking: booking, reviewer: "user"), class: "text-alert" %>
              <% else %>
                Your rating: <%= ("<i class=\"fas fa-star\"></i>" * booking.review.personality_rating).html_safe %>
              <% end %>
            </p>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>

  <% if @user.is_partner == false %>
    <h3>Want to become a partner?</h3>
      <p>Your profile just allows you to book dates with personalities for now. If you want to become datable as well, click on the below button to become a partner and create your first personality.</p>
    <%= link_to "Become a partner", new_personality_path(partner: true), class: "btn btn-green" %>
  <% else %>
    <h3>Your personalities</h3>
    <% if @user.personalities.empty? %>
      <p>You don't have any personalities yet, you should <%= link_to "create your first one", personalities_path %> for others to find you. ğŸ˜</p>
    <% else %>
      <% @personalities = @user.personalities %>
      <%= render 'shared/cards-display' %>

      <h3>Your bookings as a partner</h3>
      <% if @user.personalities.each { |personality| personality.bookings }.empty? %>
        <p>Looks like noone has booked you yet, you could try <%= link_to "creating a new personality", personalities_path %> ğŸ˜ƒ</p>
      <% else %>
            <div class="booking-card-container">
          <% @user.personalities.each do |personality| %>
            <% personality.bookings.each do |booking| %>
              <div class="booking-card">
                <img src="<%= booking.user.picture %>" alt="" class="big-avatar">
                <div class="booking-card-details">
                  <p><strong>When?</strong> <%= booking.date %></p>
                  <p><strong>With who?</strong> <%= booking.user.first_name + " " + booking.user.last_name %></p>
                </div>
                <div>
                  <p>
                    <%= link_to "Delete booking", booking_path(booking), method: :delete, data: { confirm: "Are you sure you want to delete this booking?" }, class: "text-danger" %>
                  </p>
                  <p>
                    <%= link_to "Add a review", new_review_path(booking: booking, reviewer: "personality"), class: "text-alert" %>
                  </p>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      <% end %>
    <% end %>
  <% end %>
</div>
